{% extends 'base.html' %}

{% block title %}Order {{ order.id }} | GSP{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/order.css') }}">
{% endblock %}

{% block body %}
<div class="order-box">
    {% with msg = get_flashed_messages() %}
        {% if msg: %}<div class="order-msg">{{ msg[0] }}</div>{% endif %}
    {% endwith %}

    <div class="order-service">
        {% set service = Service.query.filter_by(id=order.service_id).first() %}
        <h2>
            <b>Order For:</b>
            <a href="{{ url_for('service', id=order.service_id) }}" target="_blank">
                {{ service.title }}
                <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M6 6v2h8.59L5 17.59L6.41 19L16 9.41V18h2V6z"/>
                </svg>
            </a>
        </h2>
        {% set department = Department.query.filter_by(id=order.service_id).first() %}
        {% if department %}
            <h3>
                <a href="{{ url_for('department', id=department.id) }}" target="_blank">
                    {{ department.title }}
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M6 6v2h8.59L5 17.59L6.41 19L16 9.41V18h2V6z"/>
                    </svg>
                </a>
            </h3>
        {% endif %}
    </div>
    <p class="order-id" style="margin-bottom: 25px;"><b>Reference Number:</b> <span>{{ order.id }}</span></p>
    <p class="attention-msg">
        <span>*</span>
        You may be asked for your reference number later to complete any necessary transactions, receive paperwork, or finalize your order.
    </p>

    <p>
        <b>Order at:</b>
        {{ naturaltime(order.start_date) }}
        -
        {% set time = strptime(str(order.start_date), "%Y-%m-%d %H:%M:%S") %}
        {{ time.strftime("%d %b, %Y at %I:%M %p") }}
    </p>
    {% if order.is_done == True %}
        <p>
            <b>Done at:</b>
            {{ naturaltime(order.end_date) }}
            -
            {% set time = strptime(str(order.end_date), "%Y-%m-%d %H:%M:%S") %}
            {{ time.strftime("%d %b, %Y at %I:%M %p") }}
        </p>
        <p><b>Status:</b> <span class="status-done">Finished</span></p>
    {% else  %}
        <p><b>Status:</b> <span class="status-active">Active</span></p>
    {% endif %}

    {% if order.details %}
        <p class="order-details">
            <b>Details Included:</b>
            <br>
            {{ order.details }}
        </p>
    {% endif %}

    {% if order.file_paths %}
    <p class="order-files">
        <b>Files Included:</b>
        <br>
        <br>
        {% for file in order.file_paths.split(',') %}
            <img src="{{ url_for('serve_file', filename=file) }}" width="300px" style="margin-bottom: 20px !important;">
            {{ file.split('_', maxsplit=1)[-1] }}
            <br>
        {% endfor %}
    </p>
    {% endif %}

    <form action="{{ url_for('order', id=order.id) }}" method="post"
        onsubmit="return confirm('Are you sure you want to delete this order?');">
        <input type="hidden" name="action" value="delete_order">
        <input class="form-btn danger" type="submit" value="Delete Order">
    </form>
</div>
{% endblock %}